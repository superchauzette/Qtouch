var exec = require('child_process').exec;
var CMD = "i2cget -y 1 0x1b 0x03 b";

function read(callback) {
   setInterval(function() {
		exec(CMD, function (error, stdout, stderr) {
			if (error !== null) {
				console.log('exec error: ' + error);
			}		
			callback(stdout.trim()) 	
		});
	}, 50 );
}

function onChange(callback){
	var oldVal = "";
	readI2C(function(newVal){
		if(newVal.trim() != oldVal.trim()){
			callback(newVal.trim(),oldVal.trim());
		}
		oldVal=newVal.trim();
	});
}

function onPressLong(callback){
	setInterval(function() {
		exec(CMD, function (error, stdout1, stderr) {
		    if(stdout1.trim() != "0x00"){
    			setTimeout(function(){
    				exec(CMD, function (error, stdout2, stderr){
     					if( stdout1.trim() == stdout2.trim() ){
     						callback(stdout1.trim());
     					}
    				});				
    			}, 1000);
		    }
		});
	},1100);
}

exports.read =  read;
exports.onChange = onChange;
exports.onPressLong = onPressLong;
